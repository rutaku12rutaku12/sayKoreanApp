# <img src="https://github.com/rutaku12rutaku12/sayKoreanApp/blob/master/src/main/saykorean/public/img/hosuni.png" width="100" height="100"/> 재밌는한국어 

## 💻 프로젝트 소개
- **프로젝트 완성일**: 2025.11.27

## 📖 프로젝트 개요
내수 시장이 줄어드는 반면 한류 시장이 커지고 있으며, 한국인의 문화적 관점에서 만든 한국어 교육 앱이 부재합니다. 이에 외국인 사용자를 대상으로 한국의 언어와 문화를 함께 교육하는 서비스를 제공하고자 프로젝트를 시작했습니다.

## 🎯 기획 목표
1. 사용자에게 한국의 언어와 문화를 함께 교육하는 '한국어 교육 & 도전' 기능 제공.
2. 한국의 전통 요소를 살린 캐릭터를 기반으로 문화를 체험하게하는 UI 제공.
   - ex) 갓을 쓴 토끼, 족두리를 쓴 호랑이 마스코트 이모티콘

## 📅 프로젝트 일정
- **1주차**: 주제 선정, 기획서 작성
- **2주차**: 1차 기능 설계 및 코드 작업, 리액트 UI 레이아웃
- **3주차**: 2차 기능 설계 및 코드 작업, 리액트 UI 완성
- **4주차**: 코드 병합 후 최종 테스트, 코드리뷰 및 트러블슈팅, 프레젠테이션

## 🧑‍💻 팀원 역할
- **정유진**: Git 관리, 프로토타입, 사용자단 교육 & 시험, 사용자단 UI, 시험 채점 API, 설정, 언어 변경, 이미지 샘플
- **최규호**: 사용자 계정, 소셜 로그인, 비밀번호 암호화, 출석, 로딩, 로봇 감지 API
- **최동진**: 기획, (구)프로토타입, 관리자단 교육 & 시험 & 회원, 관리자단 UI, 랭킹, 자동 번역 API, TTS API

## 🛠️ 기술 스택

### Backend
- Java
- Spring Boot
- Spring Security
- MyBatis
- MySQL
- Lombok
- Bcrypt
- Validation

### Frontend
- React
- Redux
- Redux-Persist
- React-Router-DOM
- JSX
- JavaScript
- CSS

### API & Library
- Google Cloud Translation API
- Google Cloud Text-to-Speech API
- Google Gemini API
- Crizin (발음기호 라이브러리)
- reCAPTCHA
- i18next (언어 변경)

### 추가사항

#### 시스템 설계
- **메뉴 구조**: 관리자(교육 관리, 시험 관리, 회원 관리), 사용자(교육, 시험, 마이페이지, 랭킹)
- **DB 설계**: ERD 기반 PK/FK 구조, 관리자/사용자 도메인 분리
- **기능 흐름도**: 교육 등록(관리자) -> 시험 등록(관리자) -> 마이페이지 언어 선택(사용자) -> 교육 조회(사용자) -> 시험 조회(사용자) -> 랭킹 조회(사용자)

#### 주요 기능
- 스프링 시큐리티 & 비크립트 기반 인증 및 보안 처리
- 마스코트 캐릭터 이미지, TTS 등을 활용한 교육 로직
- 그림, 음성, 주관식으로 이루어진 시험 로직
- 다국어 언어 지원 로직

#### 코드 리뷰
- **reCAPTCHA 검증 로직**
  - 사용자가 웹에서 “로봇이 아닙니다“ 체크박스를 클릭 할 때 비정상적인 행동이 감지되면 내부적으로 사용자에게 추가 검증을 요구하는 로직
  - 사용자가 체크박스를 클릭하면 구글이 발급한 reCAPTCHA 응답 토큰(response token) 생성
  - 위의 응답 토큰을 받아서 구글 검증 서버로 POST 요청 전송, 비밀키와 사용자 응답토큰을 함께 보냄
  - 구글 reCAPTCHA 서버에서 전달받은 비밀키와 응답 토큰이 일치하는지 검증한 결과를 JSON 형태(“success”: true/false)로 서버에 반환함
  - 서버는 사용자에게 응답이 false이면 가입이 제한되고, true면 인증 성공으로 가입을 진행

- **서술형 답안 자동 채점 로직**
  - 사용자가 테스트를 볼 때 주관식 문제 답을 서술형으로 입력하면 GEMINI AI API를 사용해 의미적 동등성, 문법, 관련성 등을 고려하여 자동으로 채점해주는 로직
  - API를 요청하는 객체를 생성하고, GEMINI API 모델을 설정함
  - 발급받은 APP KEY를 환경변수로 저장하고 출력함
  - GEMINI AI에게 보낼 사용자 응답과 요청 사항을 만든다
  - GEMINI-2.5 flash 버전은 text가 바로 JSON에 들어갈 수 없기 때문에 따로 배열 처리함
  - 모델명과 APP KEY를 사용해 요청을 생성함
  - 요청에 맞춰 전송 후, 전달 받은 값을 다시 파싱하여 변수에 저장함
  - → 서술형 문제를 객관식처럼 채점할 경우 한국어의 특성상 어투나 어순에 따라 오답으로 채점될 수 있는 경우의 수가 너무 많기 때문에 ai가 그런 점을 감안해서 채점하도록 설계

- **교육 생성 플로우 자동화 로직**
  - 관리자단 클라이언트 페이지 내부에서 한국어 예문을 입력하고 로직을 실행하면, Google Translation API를 통해 다국어 예문으로 번역하는 로직 
  - API를 요청하는 객체를 생성하고, 원본 언어와 번역할 다국어, 번역할 테스트, 번역이 이루어지는 경로 등을 설정
  - 클라이언트에서 API를 호출하여 번역 요청을 하면, 다국어로 원본 언어를 번역
  - 로그를 확인하여 번역 로직 후 생성된 텍스트와 글자 수를 반환하여, API가 정상 작동하는지 체크할 수 있음
  - 로그를 확인하여 주제와 해설, 예문 중 어떤 한국어가 번역되고 있는지 체크할 수 있음
  - 번역 로직을 서버로 응답 반환할 객체 생성
  - study 테이블 DB에 저장할 주제와 해설 번역문을 생성
  - exam 테이블 DB에 저장할 예문 번역문을 생성
  - 관리자단 클라이언트 페이지 내부에서 한국어/영어 예문을 입력하고 로직을 실행하면, Google Text-To-Speech API를 통해 음성 파일을 생성하는 로직
  - Google Clound의 인증 정보를 json 파일 형식으로 확인 후, 계정 정보 확인한 뒤 TTS 클라이언트 설정
  - 변환할 텍스트를 SynthesisInput 객체에 담고, 음성과 오디오 포맷을 설정
  - 2번에서 만든 텍스트와 설정을 종합하여 TTS 파일 생성 요청 실행
  - 생성한 오디오 파일을 바이트 배열로 반환

#### 트러블 슈팅

- **로그인을 2번 클릭 해야 작동하는 오류**
  - 소셜 로그인 버튼을 처음 클릭했을 때, 백엔드 콘솔에서는 정상적으로 로그인 처리가 완료되지만 프론트엔드 화면은 로그인 전 상태를 유지했고, 두 번째 클릭 했을 때 로그인이 되는 비정상적인 작동이 발생
  - 백엔드, 프론트엔드 둘 다 콘솔에 오류 로그가 발생하지 않았고, 프론트엔드는 소셜 로그인에 대한 코드가 단 한 줄이었고. 백엔드 로직은 여러 파일로 구성되어 있기 때문에 백엔드에 문제가 있다고 생각했고 백엔드 로직만 5시간 넘게 수정해봤으나 해결되지 않음
  - 스스로에 한계를 느끼고 여러 동료 분들에게 조언을 얻어서 백엔드에서 로그인 상태를 콘솔에 출력하는 것과 동일하게 프론트엔드에서도 로그인 상태정보를 콘솔에 찍었더니 로그인 상태가 되어 있다는 true 값이 출력되고 있었음
  - 화면은 여전히 로그인 전 상태를 렌더링 하고 있었고, 그 상태에서 내 정보 페이지를 눌렀더니 로그인이 된 상태였으며, 로그인은 실제로 되었지만 화면만 렌더링이 안된 것 뿐이었음
  - dispatch를 통해 로그인 상태가 업데이트 되는 것과 별개로, 로그인 상태가 true라면 페이지를 강제 이동시키는 로직을 만들어서 해결됨 

- **GEMINI API에 요청이 전달되지 않는 오류**
  - 프론트에서 서술형 정답 입력 시 관리자가 설정한 정답을 기준으로 의미적 동등성, 문법 등을 고려하여 100점 만점으로 점수가 출력되어야 정상인데 어떤 답을 입력해도 0점이 출력되는 문제가 발생함
  - console 출력 시 JSON 형식에 오류가 있어서 전달이 되지 않는다고 출력됨
  - AI API 사용 시 prompt 형식도 맞춰서 썼고, JSON 형식도 맞췄는데도 불구하고 GEMINI API에 요청이 전달되지 못하는 오류가 발생
  - → GPT에 전달되지 못하는 오류가 발생하는 경우 전부 0점으로 예외 처리되도록 로직 설계
  - 인텔리제이 터미널에서 직접 테스트 해본 결과, 해당 API MODEL에서 지원하지 않는 JSON 형식인 것을 발견, 확인해보니 사용하려던 API 버전은 종료된 버전이었고 최신 버전은 JSON 안에 바로 text를 바로 넣을 수 없게 되어있어 배열로 출력했더니 요청이 전송됨
  - **왜?** generateContent의 요청 스키마가 “배열 구조”를 요구하기 때문에 contents와 그 안의 parts를 배열로 보냄
  - 텍스트 한 줄만 보내더라도 기본 배열 구조는 유지해야 하기 때문에 parts를 사용해야 함

- **다국어 지원 로직으로 발생한 컴파일 버퍼 문제 해결**
  - 리액트 UI에서 사용자가 언어 설정을 했을 때, 해당 언어가 나올 수 있도록 i18nService에서 다국어 예문을 관리했음
  - 그 이후로 3분 이상의 컴파일 시간이 걸려 개발 단계의 실행 테스트에 어려움을 겪음
  - Map.entry에 더 많은 구문을 집어넣을 수록 컴파일 시간이 기하급수적으로 늘어났고, 코드가 900줄을 넘었을 때 6분의 컴파일 시간이 소요
  - i18nService에서 Map.entry로 예문을 직접 넣고, i18nController로 DI 처리하는 과정에서 컴파일 속도가 느려지는 것으로 추정
  - 연관이 높은 예시인지는 알 수 없으나, i18nService 파일이 인텔리제이에서 열려있을 때 컴파일 속도가 더 느려지는 현상 발견
  - 기존의 Map문을 convert.csj 파일로 붙여 넣기 후, const fs = require('fs'); entry의 구문들을 다국어코드.json 파일화함
  - json으로 변환한 후, I18nService에서는 json 파일을 로드시키는 방법으로 컴파일 시간을 기존의 2~10초 내외로 단축시킴

- **비동기로 인한 다국어 설정 상태 초기화 문제 해결**
  - 외국어를 선택한 사용자의 교육과 시험 로직에서, 선택 언어 대신 한국어가 프론트엔드로 출력되는 현상이 발생함
  - 사용자의 언어 설정을 관리하는 langNo 상태가 0으로 초기화된 상태에서, useEffect가 비동기 업데이트되면 한국어가 출력됨
  - 열 번 시도하면 한 번 한국어가 출력되는, 전형적인 비동기상태 현상을 보여줌
  - Controller에서 int 값을 반환하던 langNo 변수를 Interger로 설정하여, 0 대신 null 값을 반환할 수 있도록 함
  - useEffect 내부에서 langNo를 확인하는 함수를 추가하여, langNo를 확인할 수 없는 상황에서는 return시켜서 동기화 상태로 넘어가도록 유도함
  - langNo를 확인한 후에 비동기 함수 실행하여, 사용자가 설정한 언어대로 출력함

- **파일명 및 폴더명 세분화를 통한 관리 유연성 증진**
  - 다수의 이미지와 오디오 파일 관리를 위해서, 단순하며 논리적이고 중복을 방지할 수 있는 폴더명과 파일명 생성 로직이 필요함
  - uuid로 파일명을 관리하면 중복은 방지할 수 있으나, 자연어를 사용하는 클라이언트가 파일을 관리하는데 부적합함 
  - 마찬가지로 폴더명 또한 기간 별로 관리하는 게 장기적인 유지보수에 적합
  - 월과 연별로 폴더를 생성하고, (ex : oct_25) "1_eng_voice.mp3", "1_img_png"형식으로 독해하기 편하며 중복이 없는 파일명을 생성했음
  - application.properties 설정에 upload.path=${user.dir}/src/main/saykorean/public/upload 해당 경로를 사용하여, 개발자들의 프로젝트 폴더 위치가 다르더라도 파일을 불러올 수 있도록 상대경로를 지정함

#### 향후 개선 방향
- **커뮤니티 시스템 도입**: 한국어와 문화에 관심을 갖는 다국적 사용자들의 허브 역할
- **한글 게임과 랭킹 로직 추가**: 사용자의 흥미를 유발하고 경쟁할 수 있는 한국어 교육 방식 제공
- **포인트 로직**: 사용자 행동에 따른 포인트 증가 및 앱 내부 포인트 사용을 통해 유저 어텐션 증진
- **스토어 오픈**: 앱 내부에서 활용할 수 있는 이모티콘 등 굿즈 제공으로 브랜딩 효과 상승
